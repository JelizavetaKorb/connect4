@model BLL.ECellState[][]

@if (Model != null && Model.Length > 0)
{
    var numRows = Model.Length;
    var numCols = Model[0].Length;
    
    <div class="game-board-wrapper">
        <div class="game-board-container">
            <div class="column-numbers-top">
                @for (int col = 0; col < numCols; col++)
                {
                    <div class="column-number">@(col + 1)</div>
                }
            </div>
            
            <div class="game-board" id="gameBoard">
                @for (int row = 0; row < numRows; row++)
                {
                    <div class="board-row">
                        @for (int col = 0; col < numCols; col++)
                        {
                            var cellState = Model[row][col];
                            var cellClass = cellState switch
                            {
                                BLL.ECellState.X => "cell-x",
                                BLL.ECellState.O => "cell-o",
                                BLL.ECellState.XWin => "cell-x-win",
                                BLL.ECellState.OWin => "cell-o-win",
                                _ => "cell-empty"
                            };
                            
                            <div class="board-cell @cellClass" data-row="@row" data-col="@col">
                                @if (cellState == BLL.ECellState.X || cellState == BLL.ECellState.XWin)
                                {
                                    <span>X</span>
                                }
                                else if (cellState == BLL.ECellState.O || cellState == BLL.ECellState.OWin)
                                {
                                    <span>O</span>
                                }
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
}
else
{
    <p>Board not available</p>
}

<style>
    .game-board-wrapper {
        width: 100%;
        overflow-x: auto;
        overflow-y: visible;
        display: flex;
        justify-content: center;
        padding: 10px 0;
    }

    .game-board-container {
        display: inline-block;
        background: #0066cc;
        padding: 10px;
        border-radius: 5px;
        min-width: min-content;
    }

    .column-numbers-top {
        display: flex;
        margin-bottom: 5px;
        gap: 6px;
    }

    .column-number {
        width: 60px;
        text-align: center;
        font-weight: bold;
        color: white;
        font-size: 16px;
        flex-shrink: 0;
    }

    .game-board {
        background-color: #0066cc;
    }

    .board-row {
        display: flex;
    }

    .board-cell {
        width: 60px;
        height: 60px;
        background-color: white;
        border-radius: 50%;
        margin: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: bold;
        flex-shrink: 0;
    }

    .cell-empty {
        background-color: white;
    }

    .cell-x {
        background-color: #ef4444;
        color: white;
    }

    .cell-o {
        background-color: #a855f7;
        color: white;
    }

    .cell-x-win, .cell-o-win {
        border: 4px solid #00ff00;
        box-shadow: 0 0 10px #00ff00;
        animation: winPulse 0.6s ease-in-out infinite;
    }

    .cell-x-win {
        background-color: #ef4444;
        color: white;
    }

    .cell-o-win {
        background-color: #a855f7;
        color: white;
    }

    @@keyframes winPulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
    }

    @@media (max-width: 768px) {
        .board-cell {
            width: 50px;
            height: 50px;
            font-size: 24px;
        }

        .column-number {
            width: 50px;
            font-size: 14px;
        }
    }

    @@media (max-width: 480px) {
        .board-cell {
            width: 40px;
            height: 40px;
            font-size: 20px;
            margin: 2px;
        }

        .column-number {
            width: 40px;
            font-size: 12px;
        }
    }
</style>

<script>
    window.animatePieceDrop = function(column, finalRow, pieceType) {
        const board = document.getElementById('gameBoard');
        if (!board) return Promise.resolve();

        return new Promise((resolve) => {
            const cells = board.querySelectorAll('.board-cell');
            const boardState = [];
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                
                if (!boardState[row]) boardState[row] = [];
                boardState[row][col] = cell;
            });

            const pieceSymbol = pieceType === 'X' ? 'X' : 'O';
            const cellClass = pieceType === 'X' ? 'cell-x' : 'cell-o';
            const delay = 90;
            let currentRow = 0;

            function moveToNextRow() {
                if (currentRow > 0) {
                    const prevCell = boardState[currentRow - 1][column];
                    prevCell.className = 'board-cell cell-empty';
                    prevCell.innerHTML = '';
                }
                const currentCell = boardState[currentRow][column];
                currentCell.className = `board-cell ${cellClass}`;
                currentCell.innerHTML = `<span>${pieceSymbol}</span>`;
                currentRow++;
                
                if (currentRow <= finalRow) {
                    setTimeout(moveToNextRow, delay);
                } else {
                    resolve();
                }
            }
            moveToNextRow();
        });
    };
</script>
